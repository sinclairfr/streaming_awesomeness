services:
  iptv-manager:
    user: "0:0"
    container_name: iptv-manager
    build: 
      context: .
      dockerfile: Dockerfile
    command: ["python3", "-u", "main.py"]
    volumes:
      - ./app/content:/app/content:rw
      - ./app/hls:/app/hls:rw
      - ./app/logs:/app/logs:rw
      - ./nginx_logs:/var/log/nginx:ro
      - ./app/test_stream.py:/app/test_stream.py:rw
      - ./app/iptv_channel.py:/app/iptv_channel.py:rw
      - ./app/iptv_manager.py:/app/iptv_manager.py:rw

    environment:
      - USE_GPU=auto
      - SERVER_URL=192.168.10.120
    restart: unless-stopped

  nginx:
    user: "0:0"
    container_name: iptv-nginx
    image: nginx:alpine
    ports:
      - "80:80"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf:ro
      - ./app/hls:/hls:ro
      - ./nginx_logs:/var/log/nginx:rw
    depends_on:
      - iptv-manager
    restart: unless-stopped